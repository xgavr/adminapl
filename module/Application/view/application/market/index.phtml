<?php
use Application\Entity\MarketPriceSetting;

$this->headTitle('Прайс листы для торговых площадок');

$this->mainMenu()->setActiveItemId('apl');

$this->pageBreadcrumbs()->setItems([
            'Главная'=>$this->url('home'),
            'Администрирование'=>$this->url('admin'),
            'Прайс листы для торговых площадок' => $this->url('market')
            ]);  

?>
<p>
    <button class="btn btn-default market-modal-show" type="button" modal-url="/market/edit-form">
        <span class="glyphicon glyphicon-plus" aria-hidden="true"> Добавить</span>
    </button>                
</p>

<table class="table table-striped">

   <tr>
        <th>Id</th>
        <th>Наименование</th>
        <th>Файл</th>        
        <th>Формат</th>
        <th>Фильтры</th>
        <th>Статус</th>        
        <th>Дата выгрузки</th>        
        <th></th>        
    </tr>
    
    <?php foreach ($markets as $market): ?>
    
    <tr>
        <td><?= $this->escapeHtml($market->getId()); ?></td>
        <td>
            <?= $this->escapeHtml($market->getName()); ?>
        </td>
        <td>
            <?= $this->escapeHtml($market->getFilename()); ?>
        </td>
        <td>
            <?= $this->escapeHtml($market->getFormatAsString()); ?>
        </td>
        <td>
            <small>
                
            <table>
                <tr>
                    <td>Регион:</td>
                    <td> <?= $this->escapeHtml($market->getRegion()->getName());?></td>
                    <td>|</td>
                    <td>Наименования:</td>
                    <td> <?= $this->escapeHtml($market->getNameSettingAsString());?></td>
                </tr>
                <tr>
                    <td>Картинки:</td>
                    <td> <?= $this->escapeHtml($market->getGoodSettingAsString());?></td>
                    <td>|</td>
                    <td>Картинок:</td>
                    <td> <?= $this->escapeHtml($market->getImageCount());?></td>
                </tr>
                <tr>
                    <td>Остатки:</td>
                    <td> <?= $this->escapeHtml($market->getRestSettingAsString());?></td>
                    <td>|</td>
                    <td>Поставщики:</td>
                    <td> <?= $this->escapeHtml($market->getSupplierSettingAsString());?></td>
                </tr>
                <tr>
                    <td>Производители:</td>
                    <td> <?= $this->escapeHtml($market->getProducerSettingAsString());?></td>
                    <td>|</td>
                    <td>Группы ТД:</td>
                    <td> <?= $this->escapeHtml($market->getGroupSettingAsString());?></td>
                </tr>
                <tr>
                    <td>Группы наименований:</td>
                    <td> <?= $this->escapeHtml($market->getTokenGroupSettingAsString());?></td>
                    <td>|</td>
                    <td>Колонка цен</td>
                    <td> <?= $this->escapeHtml($market->getPricecolAsString());?></td>
                </tr>
                <tr>
                    <td>Цена минимальная:</td>
                    <td> <?= $this->escapeHtml($market->getMinPrice());?></td>
                    <td>|</td>
                    <td>Цена максимальная:</td>
                    <td> <?= $this->escapeHtml($market->getMaxPrice());?></td>
                </tr>
                <tr>
                    <td>Выгружать строк:</td>
                    <td> <?= $this->escapeHtml($market->getMaxRowCount());?></td>
                    <td>|</td>
                    <td>Делить на блоки:</td>
                    <td> <?= $this->escapeHtml($market->getBlockRowCount());?></td>
                </tr>
                <tr>
                    <td>Коментарий:</td>
                    <td colspan="4"> <?= $this->escapeHtml($market->getInfo());?></td>
                </tr>
            </table>
            </small>
        </td>
        <td>
            <?= $this->escapeHtml($market->getStatusAsString()); ?>
        </td>
        <td>
            <?= $this->escapeHtml($market->getDateUnload()); ?>
        </td>
        <td>
            <button class="btn btn-xs btn-info market-modal-show" type="button" modal-url="/market/edit-form/<?= $market->getId()?>">
                <span class="glyphicon glyphicon-pencil" ></span>
            </button>
            <button class="btn btn-xs btn-danger this-delete" value="<?= $this->url('market', 
                    ['action'=>'delete', 'id'=>$market->getId()]); ?>">
                <span class="glyphicon glyphicon-remove" ></span>
            </button>
        </td>    
    </tr>
        
    <?php endforeach; ?>   
    
</table>

<script type="text/javascript">
    $(function () {
        $(document).on('click', '.market-modal-show', function (e) {
            var url = $(e.currentTarget).attr('modal-url');
            showFormDialog({
                id: 'marketModal',
                url: url,
                width: '1440px'
            });
        });          
    });
    
    $('.rate-select').on('click', function(e) {
        var url = e.currentTarget.value;
        bootbox.prompt({
            title: "Выбрать расценку",
            value: ['1', '3'],
            inputType: 'checkbox',
            inputOptions: [{
                text: 'Choice One',
                value: '1',
            },
            {
                text: 'Choice Two',
                value: '2',
            },
            {
                text: 'Choice Three',
                value: '3',
            }],
            callback: function (result) {
                console.log(result);
            }
        });
    });    
</script>