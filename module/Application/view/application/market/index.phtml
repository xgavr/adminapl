<?php
use Application\Entity\MarketPriceSetting;

$this->headTitle('Прайс листы для торговых площадок');

$this->mainMenu()->setActiveItemId('apl');

$this->pageBreadcrumbs()->setItems([
            'Главная'=>$this->url('home'),
            'Администрирование'=>$this->url('admin'),
            'Прайс листы для торговых площадок' => $this->url('market')
            ]);  

?>
<p>
    <button class="btn btn-default market-modal-show" type="button" modal-url="/market/edit-form">
        <span class="glyphicon glyphicon-plus" aria-hidden="true"> Добавить</span>
    </button>                
</p>

<table class="table table-striped">

   <tr>
        <th>Id</th>
        <th>Наименование</th>
        <th>Файл</th>        
        <th>Формат</th>
        <th>Фильтры</th>
        <th>Статус</th>        
        <th>Дата выгрузки</th>        
        <th></th>        
    </tr>
    
    <?php foreach ($markets as $market): ?>
    
    <tr>
        <td><?= $this->escapeHtml($market->getId()); ?></td>
        <td>
            <?= $this->escapeHtml($market->getName()); ?>
        </td>
        <td>
            <?= $this->escapeHtml($market->getFilename()); ?>
        </td>
        <td>
            <?= $this->escapeHtml($market->getFormatAsString()); ?>
        </td>
        <td>
            Регион: <?= $this->escapeHtml($market->getRegion()->getName()); ?>
            <br/>Картинки: <?= $this->escapeHtml($market->getGoodSettingAsString()); ?>
            <br/>Картинок: <?= $this->escapeHtml($market->getImageCount()); ?>
            <br/>Наименования: <?= $this->escapeHtml($market->getNameSettingAsString()); ?>
            <br/>Остатки: <?= $this->escapeHtml($market->getRestSettingAsString()); ?>
            <br/>Поставщики: <?= $this->escapeHtml($market->getSupplierSettingAsString()); ?>
            <br/>Производители: <?= $this->escapeHtml($market->getProducerSettingAsString()); ?>
            <br/>Группы ТД: <?= $this->escapeHtml($market->getGroupSettingAsString()); ?>
            <br/>Группы наименований: <?= $this->escapeHtml($market->getTokenGroupSettingAsString()); ?>
            <br/>Цена минимальная: <?= $this->escapeHtml($market->getMinPrice()); ?>
            <br/>Цена максимальная: <?= $this->escapeHtml($market->getMaxPrice()); ?>
            <br/>Выгружать строк: <?= $this->escapeHtml($market->getMaxRowCount()); ?>
            <br/>Делить на блоки: <?= $this->escapeHtml($market->getBlockRowCount()); ?>
            <br/>Колонка цен: <?= $this->escapeHtml($market->getPricecolAsString()); ?>
            <br/>Коментарий: <?= $this->escapeHtml($market->getInfo()); ?>
        </td>
        <td>
            <?= $this->escapeHtml($market->getStatusAsString()); ?>
        </td>
        <td>
            <?= $this->escapeHtml($market->getDateUnload()); ?>
        </td>
        <td>
            <button class="btn btn-xs btn-info market-modal-show" type="button" modal-url="/market/edit-form/<?= $market->getId()?>">
                <span class="glyphicon glyphicon-pencil" ></span>
            </button>
            <button class="btn btn-xs btn-danger this-delete" value="<?= $this->url('market', 
                    ['action'=>'delete', 'id'=>$market->getId()]); ?>">
                <span class="glyphicon glyphicon-remove" ></span>
            </button>
        </td>    
    </tr>
        
    <?php endforeach; ?>   
    
</table>

<script type="text/javascript">
    $(function () {
        $(document).on('click', '.market-modal-show', function (e) {
            var url = $(e.currentTarget).attr('modal-url');
            showFormDialog({
                id: 'marketModal',
                url: url,
                width: '1440px'
            });
        });          
    });
    
    $('.rate-select').on('click', function(e) {
        var url = e.currentTarget.value;
        bootbox.prompt({
            title: "Выбрать расценку",
            value: ['1', '3'],
            inputType: 'checkbox',
            inputOptions: [{
                text: 'Choice One',
                value: '1',
            },
            {
                text: 'Choice Two',
                value: '2',
            },
            {
                text: 'Choice Three',
                value: '3',
            }],
            callback: function (result) {
                console.log(result);
            }
        });
    });    
</script>